!function t(e,r,n){function i(l,a){if(!r[l]){if(!e[l]){var s="function"==typeof require&&require;if(!a&&s)return s(l,!0);if(o)return o(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[l]={exports:{}};e[l][0].call(c.exports,function(t){var r=e[l][1][t];return i(r?r:t)},c,c.exports,t,e,r,n)}return r[l].exports}for(var o="function"==typeof require&&require,l=0;l<n.length;l++)i(n[l]);return i}({1:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t){function e(t,e){return t===e||null==t&&null==e||null!=t&&null!=e&&t.constructor===Array&&t[0]===e[0]&&t[1]===e[1]}t.requestModules(["Array"]).then(function(){var r=function(r){function l(t,e,r){n(this,l);var o=i(this,Object.getPrototypeOf(l).call(this,t,e,r));return o.instances=[],o.eventHandler._pullChanges=function(){o.instances.forEach(function(t){t.editor.update()})},o._quillBlockFormats=["blockquote","header","indent","list","align","direction","code-block"],o}return o(l,r),a(l,[{key:"_sanitizeOpAttributes",value:function(t){if(null==t||0===Object.keys(t).length)return null;var e={};for(var r in t)this._quillBlockFormats.some(function(t){return t===r})?e._block=[r,t[r]]:e[r]=t[r];return e}},{key:"_formatAttributesForQuill",value:function(t){var e={};for(var r in t){var n=t[r];"_block"===r?n&&(e[t[r][0]]=t[r][1]):e[r]=n}return e}},{key:"_destroy",value:function(){for(var t=this.instances.length-1;t>=0;t--)this.unbindQuill(this.instances[t].editor);s(Object.getPrototypeOf(l.prototype),"_destroy",this).call(this)}},{key:"toString",value:function(){return this._content.map(function(t){if("string"==typeof t.val)return t.val}).join("")}},{key:"toDelta",value:function(){function t(){var t={};for(var e in l.attributes)t[e]=l.attributes[e];l={insert:[],attributes:t}}for(var e=this,r=!1,n=this._content.length-1;n>=0;n--){var i=this._content[n];if(i.val.constructor!==Array){"\n"===i.val&&(r=!0);break}}r||this.push("\n");var o=[],l={insert:[],attributes:{}};for(n=0;n<this._content.length;n++){var a=this._content[n].val;if(a.constructor===Array){if(!l.attributes.hasOwnProperty(a[0])&&null==a[1]||l.attributes[a[0]]===a[1])continue;l.insert.length>0&&(l.insert=l.insert.join(""),o.push(l),t()),null===a[1]?delete l.attributes[a[0]]:l.attributes[a[0]]=a[1]}else"string"==typeof a?l.insert.push(a):(l.insert.length>0&&(l.insert=l.insert.join(""),o.push(l),t()),l.insert=a,o.push(l),t())}return l.insert.length>0&&(l.insert=l.insert.join(""),o.push(l)),o.forEach(function(t){0===Object.keys(t.attributes).length?delete t.attributes:t.attributes=e._formatAttributesForQuill(t.attributes)}),o}},{key:"insert",value:function(t,e){for(var r=0,n={},i=0;i<this._content.length&&r!==t;i++){var o=this._content[i].val;o.constructor!==Array?r++:null===o[1]?delete n[o[0]]:n[o[0]]=o[1]}var a;return a="string"==typeof e?e.split(""):e.constructor===Object?[e]:e,s(Object.getPrototypeOf(l.prototype),"insert",this).call(this,i,a),n}},{key:"delete",value:function(t,r){var n=0,i={},o=t+r;if(!(r<=0)){var a,u,c,f;for(a=0;n<t&&a<this._content.length;a++)c=this._content[a].val,c.constructor!==Array?n++:i[c[0]]=c[1];for(u=a;n<o&&u<this._content.length;u++)c=this._content[u].val,c.constructor!==Array&&n++;if(u===this._content.length)s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,a,u-a);else{c.constructor!==Array&&u--;var h={};for(f=u;f>=a;f--)if(c=this._content[f].val,c.constructor===Array)void 0===h[c[0]]?(e(c[1],i[c[0]])&&s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,f,1),h[c[0]]=c[1]):s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,f,1);else{for(var v=f+1;f>a&&(c=this._content[f-1].val,c.constructor!==Array);)f--;s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,f,v-f)}}}}},{key:"select",value:function(t,r,n,i){if(null==t||null==r||null==n||void 0===i)throw new Error("You must define four parameters");for(var o,a,u=[n,null],c=0,f=0;f<this._content.length&&c!==t;f++){var h=this._content[f].val;h.constructor===Array?h[0]===n&&(u[1]=h[1]):c++}e(u[1],i)||(o=f,a=[n,i]);for(var v=[];f<this._content.length&&c!==r;f++){var p=this._content[f].val;p.constructor===Array?p[0]===n&&(u[1]=p[1],v.push(f)):c++}for(var y=v.length-1;y>=0;y--){var b=v[y];s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,b,1),b<f&&f--,b<o&&o--}if(!e(u[1],i)&&f<this._content.length){var g,d=!0;for(y=f;y<this._content.length&&(g=this._content[y].val,g.constructor===Array);y++)if(g[0]===n){d=!1,e(g[1],i)&&s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,y,1);break}if(d){var _=[n,u[1]];s(Object.getPrototypeOf(l.prototype),"insert",this).call(this,f,[_])}}if(null!=o)for(s(Object.getPrototypeOf(l.prototype),"insert",this).call(this,o,[a]),y=o-1;y>=0&&(g=this._content[y].val,g.constructor===Array);y--)g[0]===n&&s(Object.getPrototypeOf(l.prototype),"delete",this).call(this,y,1)}},{key:"applyDelta",value:function(t,r){for(var n,i=0,o=0;o<t.ops.length;o++){var l,a,s=t.ops[o],u=this._sanitizeOpAttributes(s.attributes);if(null!=s.insert){"string"==typeof s.insert?(l=this.insert(i,s.insert),a=s.insert.length):(l=this.insert(i,s.insert),a=1);for(n in u)e(u[n],l[n])||this.select(i,i+a,n,u[n]);for(n in l)null!=u&&null!=u[n]||this.select(i,i+a,n,null);i+=a}if(null!=s.delete&&this.delete(i,s.delete),null!=s.retain&&null!=r){var c=i+s.retain;if(c>this.length){var f=r.getText(this.length);r.insertText(this.length,f);for(n in u){var h={};h[n]=!1,h=this._formatAttributesForQuill(h),r.formatText(this.length+f.length,f.length,h)}this.insert(this.length,f)}for(n in u){var v=u[n];this.select(i,c,n,v);var p={};if(p[n]=null!=v&&v,p=this._formatAttributesForQuill(p),"_block"===n){var y={};this._quillBlockFormats.forEach(function(t){y[t]=!1}),r.formatText(i,s.retain,y)}r.formatText(i,s.retain,p)}i=c}}}},{key:"bind",value:function(){this.bindQuill.apply(this,arguments)}},{key:"unbindQuill",value:function(t){var e=this.instances.findIndex(function(e){return e.editor===t});if(e>=0){var r=this.instances[e];this.unobserve(r.yCallback),r.editor.off("text-change",r.quillCallback),this.instances.splice(e,1)}}},{key:"bindQuill",value:function(r){function n(t){if(a){a=!1;try{t()}catch(t){throw a=!0,new Error(t)}a=!0}}function i(t){n(function(){l.applyDelta(t,r)})}function o(i){n(function(){var n,o;if("insert"===i.type)for(var a=0;a<i.values.length;){for(var s=[];a<i.values.length&&i.values[a].constructor!==Array;)s.push(i.values[a]),a++;if(s.length>0){for(var u=0,c={},f=0;f<i.index;f++)n=l._content[f].val,n.constructor!==Array?u++:c[n[0]]=n[1];for(f=i.index+i.length;f<l._content.length&&(n=l._content[f].val,n.constructor===Array);)c.hasOwnProperty(n[0])||(c[n[0]]=null),f++;for(var h in c)null==c[h]&&(c[h]=!1);if(l.length===u+s.length&&"\n"!==s[s.length-1]){var v=["\n"],p={};for(h in c)c[h]!==!1&&(v.unshift([h,!1]),p[h]=!1);t.Array.typeDefinition.class.prototype.insert.call(l,u+s.length,v),r.insertText(u,"\n",l._formatAttributesForQuill(p))}var y=[];u>0&&y.push({retain:u});var b=[];s.forEach(function(t){"string"==typeof t?b.push(t):(b.length>0&&(y.push({insert:b.join(""),attributes:c}),b=[]),y.push({insert:t,attributes:c}))}),b.length>0&&y.push({insert:b.join(""),attributes:c}),y.forEach(function(t){null!=t.attributes&&Object.keys(t.attributes).length>0?t.attributes=l._formatAttributesForQuill(t.attributes):delete t.attributes}),r.updateContents(y)}else{o=null;for(var g=i.values[a++],d=0,_=i.index+a-2;_>=0;_--)if(n=l._content[_].val,n.constructor===Array){if(g[0]===n[0]){o=n[1];break}}else d++;for(;_>=0;_--)n=l._content[_].val,n.constructor!==Array&&d++;if(e(g[1],o))continue;for(var O=d,x=i.index+a;x<l._content.length;x++)if(n=l._content[x].val,n.constructor===Array){if(n[0]===g[0])break}else O++;if(d!==O){var k={};if(k[g[0]]=null!=g[1]&&g[1],k=l._formatAttributesForQuill(k),"_block"===g[0]){var A={};l._quillBlockFormats.forEach(function(t){A[t]=!1}),r.formatText(d,O-d,A)}r.formatText(d,O-d,k)}}}else if("delete"===i.type){for(var m=[],j=0,w=0;j<i.length;j++)i.values[j].constructor===Array&&(j!==w&&m.push({type:"text",length:j-w,index:i.index}),w=j+1,m.push({type:"selection",val:i.values[j],index:i.index}));j!==w&&m.push({type:"text",length:j-w,index:i.index}),m.forEach(function(t){if("text"===t.type){for(var i=0,a=0;a<t.index;a++)n=l._content[a].val,n.constructor!==Array&&i++;r.deleteText(i,t.length)}else{o=null;var s,u=0;for(s=t.index-1;s>=0;s--)if(n=l._content[s].val,n.constructor===Array){if(n[0]===t.val[0]){o=n[1];break}}else u++;for(;s>=0;s--)n=l._content[s].val,n.constructor!==Array&&u++;var c=u;for(s=t.index;s<l._content.length;s++)if(n=l._content[s].val,n.constructor===Array){if(n[0]===t.val[0])break}else c++;if(!e(o,t.val[1])&&u!==c){var f={};if(f[t.val[0]]=null!=o&&o,f=l._formatAttributesForQuill(f),"_block"===t.val[0]){var h={};l._quillBlockFormats.forEach(function(t){h[t]=!1}),r.formatText(u,c-u,h)}r.formatText(u,c-u,f)}}})}r.update()})}var l=this,a=!0;r.setContents(this.toDelta()),r.on("text-change",i),this.observe(o),this.instances.push({editor:r,yCallback:o,quillCallback:i})}},{key:"length",get:function(){return this.toString().length}}]),l}(t.Array.typeDefinition.class);t.extend("Richtext",new t.utils.CustomTypeDefinition({name:"Richtext",class:r,struct:"List",initType:regeneratorRuntime.mark(function e(n,i){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],e.delegateYield(t.Struct.List.map.call(this,i,function(t){if(t.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");t.content.forEach(function(e,r){o.push({id:[t.id[0],t.id[1]+r],val:t.content[r]})})}),"t0",2);case 2:return e.abrupt("return",new r(n,i.id,o));case 3:case"end":return e.stop()}},e,this)}),createType:function(t,e){return new r(t,e.id,[])}}))})}var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var l=i.get;if(void 0!==l)return l.call(n)};e.exports=l,"undefined"!=typeof Y&&l(Y)},{}]},{},[1]);
//# sourceMappingURL=y-richtext.js.map
