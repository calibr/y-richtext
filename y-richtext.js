!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return i(n?n:t)},u,u.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){t.requestModules(["Array"]).then(function(){var e=function(e){function n(t,e,o){r(this,n);var s=i(this,Object.getPrototypeOf(n).call(this,t,e,o));return s.instances=[],s}return o(n,e),a(n,[{key:"_destroy",value:function(){for(var t=this.instances.length-1;t>=0;t--)this.unbindQuill(this.instances[t].editor);l(Object.getPrototypeOf(n.prototype),"_destroy",this).call(this)}},{key:"toString",value:function(){return this._content.map(function(t){return"string"==typeof t.val?t.val:void 0}).join("")}},{key:"toDelta",value:function(){function t(){var t={};for(var e in n.attributes)t[e]=n.attributes[e];n={insert:[],attributes:t}}for(var e=[],n={insert:[],attributes:{}},r=0;r<this._content.length;r++){var i=this._content[r].val;i.constructor===Array?(n.insert.length>0&&(n.insert=n.insert.join(""),e.push(n),t()),null===i[1]?delete n.attributes[i[0]]:n.attributes[i[0]]=i[1]):n.insert.push(i)}return n.insert.length>0&&(n.insert=n.insert.join(""),e.push(n)),e}},{key:"insert",value:function(t,e){for(var r=0,i={},o=0;o<this._content.length&&r!==t;o++){var s=this._content[o].val;"string"==typeof s?r++:s.constructor===Array&&(null===s[1]?delete i[s[0]]:i[s[0]]=s[1])}return l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,o,e.split("")),i}},{key:"delete",value:function(t,e){var r=0,i={},o=t+e;if(!(0>=e)){var s,a,c,u;for(s=0;t>r&&s<this._content.length;s++)c=this._content[s].val,"string"==typeof c?r++:c.constructor===Array&&(i[c[0]]=c[1]);for(a=s;o>r&&a<this._content.length;a++)c=this._content[a].val,"string"==typeof c&&r++;if(a===this._content.length)l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,s,a-s);else{"string"==typeof c&&a--;var f={};for(u=a;u>=s;u--)if(c=this._content[u].val,c.constructor===Array)void 0===f[c[0]]?(c[1]===i[c[0]]&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,u,1),f[c[0]]=c[1]):l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,u,1);else if("string"==typeof c){for(var h=u+1;u>s&&(c=this._content[u-1].val,"string"==typeof c);)u--;l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,u,h-u)}}}}},{key:"select",value:function(t,e,r,i){if(null==t||null==e||null==r||void 0===i)throw new Error("You must define four parameters");for(var o,s,a=[r,null],c=0,u=0;u<this._content.length;u++){var f=this._content[u].val;if(c===t)break;f.constructor===Array?f[0]===r&&(a[1]=f[1]):"string"==typeof f&&c++}a[1]!==i&&(o=u,s=[r,i]);for(var h=[];u<this._content.length;u++){var p=this._content[u].val;if(c===e)break;p.constructor===Array?p[0]===r&&(a[1]=p[1],h.push(u)):"string"==typeof p&&c++}for(var y=h.length-1;y>=0;y--){var v=h[y];l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,v,1),u>v&&u--,o>v&&o--}if(a[1]!==i&&u<this._content.length){var g,d=!0;for(y=u;y<this._content.length&&(g=this._content[y].val,g.constructor===Array);y++)if(g[0]===r){d=!1,g[1]===i&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,y,1);break}if(d){var b=[r,a[1]];l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,u,[b])}}if(null!=o)for(l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,o,[s]),y=o-1;y>=0&&(g=this._content[y].val,g.constructor===Array);y--)g[0]===r&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,y,1)}},{key:"applyDelta",value:function(t,e){for(var n,r=0,i=0;i<t.ops.length;i++){var o=t.ops[i];if(null!=o.insert){var s=this.insert(r,o.insert);for(n in o.attributes)o.attributes[n]!==s[n]&&this.select(r,r+o.insert.length,n,o.attributes[n]);for(n in s)(null==o.attributes||s[n]!==o.attributes[n])&&this.select(r,r+o.insert.length,n,null);r+=o.insert.length}if(null!=o["delete"]&&this["delete"](r,o["delete"]),null!=o.retain&&null!=e){var a=r+o.retain;if(a>this.length){var l=e.getText(this.length);e.insertText(this.length,l);for(n in o.attributes)e.formatText(this.length+l.length,this.length+2*l.length,n,null);this.insert(this.length,l)}for(n in o.attributes)this.select(r,r+o.retain,n,o.attributes[n]),e.formatText(r,r+o.retain,n,o.attributes[n]);r=a}}}},{key:"bind",value:function(){this.bindQuill.apply(this,arguments)}},{key:"unbindQuill",value:function(t){var e=this.instances.findIndex(function(e){return e.editor===t});if(e>=0){var n=this.instances[e];this.unobserve(n.yCallback),n.editor.off("text-change",n.quillCallback),this.instances.splice(e,1)}}},{key:"bindQuill",value:function(t){function e(t){if(o){o=!1;try{t()}catch(e){throw o=!0,new Error(e)}o=!0}}function n(n){e(function(){i.applyDelta(n,t)})}function r(n){e(function(){var e,r;if("insert"===n.type)for(var o=0;o<n.values.length;){for(var s=[];o<n.values.length&&"string"==typeof n.values[o];)s.push(n.values[o]),o++;if(s.length>0){for(var a=0,l={},c=n.index-1;c>=0;c--)e=i._content[c].val,"string"==typeof e?a++:e.constructor===Array&&"undefined"==typeof l[e[0]]&&(l[e[0]]=e[1]);t.insertText(a,s.join(""),l)}else{r=null;for(var u=n.values[o++],f=0,h=n.index+o-2;h>=0;h--)if(e=i._content[h].val,e.constructor===Array){if(u[0]===e[0]){r=e[1];break}}else"string"==typeof e&&f++;for(;h>=0;h--)e=i._content[h].val,"string"==typeof e&&f++;if(u[1]===r)continue;for(var p=f,y=n.index+o;y<i._content.length;y++)if(e=i._content[y].val,e.constructor===Array){if(e[0]===u[0])break}else"string"==typeof e&&p++;f!==p&&t.formatText(f,p,u[0],u[1])}}else if("delete"===n.type){for(var v=[],g=0,d=0;g<n.length;g++)"string"!=typeof n.values[g]&&(g!==d&&v.push({type:"text",length:g-d,index:n.index}),d=g+1,v.push({type:"selection",val:n.values[g],index:n.index}));g!==d&&v.push({type:"text",length:g-d,index:n.index}),v.forEach(function(n){if("text"===n.type){for(var o=0,s=0;s<n.index;s++)e=i._content[s].val,"string"==typeof e&&o++;t.deleteText(o,o+n.length)}else{r=null;var a,l=0;for(a=n.index-1;a>=0;a--)if(e=i._content[a].val,e.constructor===Array){if(e[0]===n.val[0]){r=e[1];break}}else"string"==typeof e&&l++;for(;a>=0;a--)e=i._content[a].val,"string"==typeof e&&l++;var c=l;for(a=n.index;a<i._content.length;a++)if(e=i._content[a].val,e.constructor===Array){if(e[0]===n.val[0])break}else"string"==typeof e&&c++;r!==n.val[1]&&l!==c&&t.formatText(l,c,n.val[0],r)}})}t.editor.checkUpdate()})}var i=this,o=!0;t.setContents(this.toDelta()),t.on("text-change",n),this.observe(r),this.instances.push({editor:t,yCallback:r,quillCallback:n})}},{key:"_changed",value:regeneratorRuntime.mark(function s(){var e=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.instances.forEach(function(t){t.editor.editor.checkUpdate()}),n.delegateYield(t.Array.typeDefinition["class"].prototype._changed.apply(this,e),"t0",2);case 2:case"end":return n.stop()}},s,this)})},{key:"length",get:function(){return this.toString().length}}]),n}(t.Array.typeDefinition["class"]);t.extend("Richtext",new t.utils.CustomType({name:"Richtext","class":e,struct:"List",initType:regeneratorRuntime.mark(function n(r,i){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],n.delegateYield(t.Struct.List.map.call(this,i,function(t){if(t.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");t.content.forEach(function(e,n){o.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})}),"t0",2);case 2:return n.abrupt("return",new e(r,i.id,o));case 3:case"end":return n.stop()}},n,this)})}))})}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function c(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:c(i,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};e.exports=s,"undefined"!=typeof Y&&s(Y)},{}]},{},[1]);
//# sourceMappingURL=y-richtext.js.map