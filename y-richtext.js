!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){t.requestModules(["Array"]).then(function(){var e=function(e){function n(t,e,o){r(this,n);var s=i(this,Object.getPrototypeOf(n).call(this,t,e,o));return s.instances=[],s.eventHandler._pullChanges=function(){s.instances.forEach(function(t){t.editor.update()})},s}return o(n,e),a(n,[{key:"_destroy",value:function(){for(var t=this.instances.length-1;t>=0;t--)this.unbindQuill(this.instances[t].editor);l(Object.getPrototypeOf(n.prototype),"_destroy",this).call(this)}},{key:"toString",value:function(){return this._content.map(function(t){return"string"==typeof t.val?t.val:void 0}).join("")}},{key:"toDelta",value:function(){function t(){var t={};for(var e in o.attributes)t[e]=o.attributes[e];o={insert:[],attributes:t}}for(var e=!1,n=this._content.length-1;n>=0;n--){var r=this._content[n];if(r.val.constructor!==Array){"\n"===r.val&&(e=!0);break}}e||this.push("\n");var i=[],o={insert:[],attributes:{}};for(n=0;n<this._content.length;n++){var s=this._content[n].val;if(s.constructor===Array){if(!o.attributes.hasOwnProperty(s[0])&&null==s[1]||o.attributes[s[0]]===s[1])continue;o.insert.length>0&&(o.insert=o.insert.join(""),i.push(o),t()),null===s[1]?delete o.attributes[s[0]]:o.attributes[s[0]]=s[1]}else"string"==typeof s?o.insert.push(s):(o.insert.length>0&&(o.insert=o.insert.join(""),i.push(o),t()),o.insert=s,i.push(o),t())}return o.insert.length>0&&(o.insert=o.insert.join(""),i.push(o)),i.map(function(t){0===Object.keys(t.attributes).length&&delete t.attributes}),i}},{key:"insert",value:function(t,e){for(var r=0,i={},o=0;o<this._content.length&&r!==t;o++){var s=this._content[o].val;s.constructor!==Array?r++:null===s[1]?delete i[s[0]]:i[s[0]]=s[1]}var a;return a="string"==typeof e?e.split(""):e.constructor===Object?[e]:e,l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,o,a),i}},{key:"delete",value:function(t,e){var r=0,i={},o=t+e;if(!(0>=e)){var s,a,u,c;for(s=0;t>r&&s<this._content.length;s++)u=this._content[s].val,u.constructor!==Array?r++:i[u[0]]=u[1];for(a=s;o>r&&a<this._content.length;a++)u=this._content[a].val,u.constructor!==Array&&r++;if(a===this._content.length)l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,s,a-s);else{u.constructor!==Array&&a--;var f={};for(c=a;c>=s;c--)if(u=this._content[c].val,u.constructor===Array)void 0===f[u[0]]?(u[1]===i[u[0]]&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,c,1),f[u[0]]=u[1]):l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,c,1);else{for(var h=c+1;c>s&&(u=this._content[c-1].val,u.constructor!==Array);)c--;l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,c,h-c)}}}}},{key:"select",value:function(t,e,r,i){if(null==t||null==e||null==r||void 0===i)throw new Error("You must define four parameters");for(var o,s,a=[r,null],u=0,c=0;c<this._content.length;c++){var f=this._content[c].val;if(u===t)break;f.constructor===Array?f[0]===r&&(a[1]=f[1]):u++}a[1]!==i&&(o=c,s=[r,i]);for(var h=[];c<this._content.length;c++){var p=this._content[c].val;if(u===e)break;p.constructor===Array?p[0]===r&&(a[1]=p[1],h.push(c)):u++}for(var v=h.length-1;v>=0;v--){var y=h[v];l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,y,1),c>y&&c--,o>y&&o--}if(a[1]!==i&&c<this._content.length){var g,b=!0;for(v=c;v<this._content.length&&(g=this._content[v].val,g.constructor===Array);v++)if(g[0]===r){b=!1,g[1]===i&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,v,1);break}if(b){var d=[r,a[1]];l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,c,[d])}}if(null!=o)for(l(Object.getPrototypeOf(n.prototype),"insert",this).call(this,o,[s]),v=o-1;v>=0&&(g=this._content[v].val,g.constructor===Array);v--)g[0]===r&&l(Object.getPrototypeOf(n.prototype),"delete",this).call(this,v,1)}},{key:"applyDelta",value:function(t,e){for(var n,r=0,i=0;i<t.ops.length;i++){var o,s,a=t.ops[i];if(null!=a.insert){"string"==typeof a.insert?(o=this.insert(r,a.insert),s=a.insert.length):(o=this.insert(r,a.insert),s=1);for(n in a.attributes)a.attributes[n]!==o[n]&&this.select(r,r+s,n,a.attributes[n]);for(n in o)(null==a.attributes||o[n]!==a.attributes[n])&&this.select(r,r+s,n,null);r+=s}if(null!=a["delete"]&&this["delete"](r,a["delete"]),null!=a.retain&&null!=e){var l=r+a.retain;if(l>this.length){var u=e.getText(this.length);e.insertText(this.length,u);for(n in a.attributes)e.formatText(this.length+u.length,u.length,n,null);this.insert(this.length,u)}for(n in a.attributes){var c=a.attributes[n];this.select(r,r+a.retain,n,c),e.formatText(r,a.retain,n,null==c?!1:c)}r=l}}}},{key:"bind",value:function(){this.bindQuill.apply(this,arguments)}},{key:"unbindQuill",value:function(t){var e=this.instances.findIndex(function(e){return e.editor===t});if(e>=0){var n=this.instances[e];this.unobserve(n.yCallback),n.editor.off("text-change",n.quillCallback),this.instances.splice(e,1)}}},{key:"bindQuill",value:function(e){function n(t){if(s){s=!1;try{t()}catch(e){throw s=!0,new Error(e)}s=!0}}function r(t){n(function(){o.applyDelta(t,e)})}function i(r){n(function(){var n,i;if("insert"===r.type)for(var s=0;s<r.values.length;){for(var a=[];s<r.values.length&&r.values[s].constructor!==Array;)a.push(r.values[s]),s++;if(a.length>0){for(var l=0,u={},c=0;c<r.index;c++)n=o._content[c].val,n.constructor!==Array?l++:u[n[0]]=n[1];for(c=r.index+r.length;c<o._content.length&&(n=o._content[c].val,n.constructor===Array);)u.hasOwnProperty(n[0])||(u[n[0]]=null),c++;for(var f in u)null==u[f]&&(u[f]=!1);if(o.length===l+a.length&&"\n"!==a[a.length-1]){var h=["\n"],p={};for(f in u)u[f]!==!1&&(h.unshift([f,!1]),p[f]=!1);t.Array.typeDefinition["class"].prototype.insert.call(o,l+a.length,h),e.insertText(l,"\n",p)}var v=[];l>0&&v.push({retain:l});var y=[];a.forEach(function(t){"string"==typeof t?y.push(t):(y.length>0&&(v.push({insert:y.join(""),attributes:u}),y=[]),v.push({insert:t,attributes:u}))}),y.length>0&&v.push({insert:y.join(""),attributes:u}),e.updateContents(v)}else{i=null;for(var g=r.values[s++],b=0,d=r.index+s-2;d>=0;d--)if(n=o._content[d].val,n.constructor===Array){if(g[0]===n[0]){i=n[1];break}}else b++;for(;d>=0;d--)n=o._content[d].val,n.constructor!==Array&&b++;if(g[1]===i)continue;for(var _=b,O=r.index+s;O<o._content.length;O++)if(n=o._content[O].val,n.constructor===Array){if(n[0]===g[0])break}else _++;b!==_&&e.formatText(b,_-b,g[0],null==g[1]?!1:g[1])}}else if("delete"===r.type){for(var x=[],j=0,k=0;j<r.length;j++)r.values[j].constructor===Array&&(j!==k&&x.push({type:"text",length:j-k,index:r.index}),k=j+1,x.push({type:"selection",val:r.values[j],index:r.index}));j!==k&&x.push({type:"text",length:j-k,index:r.index}),x.forEach(function(t){if("text"===t.type){for(var r=0,s=0;s<t.index;s++)n=o._content[s].val,n.constructor!==Array&&r++;e.deleteText(r,t.length)}else{i=null;var a,l=0;for(a=t.index-1;a>=0;a--)if(n=o._content[a].val,n.constructor===Array){if(n[0]===t.val[0]){i=n[1];break}}else l++;for(;a>=0;a--)n=o._content[a].val,n.constructor!==Array&&l++;var u=l;for(a=t.index;a<o._content.length;a++)if(n=o._content[a].val,n.constructor===Array){if(n[0]===t.val[0])break}else u++;i!==t.val[1]&&l!==u&&e.formatText(l,u-l,t.val[0],null==i?!1:i)}})}e.update()})}var o=this,s=!0;e.setContents(this.toDelta()),e.on("text-change",r),this.observe(i),this.instances.push({editor:e,yCallback:i,quillCallback:r})}},{key:"length",get:function(){return this.toString().length}}]),n}(t.Array.typeDefinition["class"]);t.extend("Richtext",new t.utils.CustomType({name:"Richtext","class":e,struct:"List",initType:regeneratorRuntime.mark(function n(r,i){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],n.delegateYield(t.Struct.List.map.call(this,i,function(t){if(t.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");t.content.forEach(function(e,n){o.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})}),"t0",2);case 2:return n.abrupt("return",new e(r,i.id,o));case 3:case"end":return n.stop()}},n,this)})}))})}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function u(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:u(i,e,n)}if("value"in r)return r.value;var o=r.get;return void 0===o?void 0:o.call(n)};e.exports=s,"undefined"!=typeof Y&&s(Y)},{}]},{},[1]);
//# sourceMappingURL=y-richtext.js.map
